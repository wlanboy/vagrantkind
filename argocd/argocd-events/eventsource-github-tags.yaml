apiVersion: argoproj.io/v1alpha1
kind: EventSource
metadata:
  name: github-tags
  namespace: argocd
spec:
  # pollInterval: Argo Events pollt die GitHub Events API statt auf Webhooks zu warten.
  # Voraussetzung: Secret "github-token" mit key "token" muss existieren.
  # kubectl create secret generic github-token -n argocd --from-literal=token=<GITHUB_PAT>
  github:
    httptester:
      owner: wlanboy
      repository: httptester
      events:
        - create
      apiToken:
        name: github-token
        key: token
      filter:
        expression: "body.payload.ref_type == 'tag'"
      pollInterval: 30s

    randomfail:
      owner: wlanboy
      repository: randomfail
      events:
        - create
      apiToken:
        name: github-token
        key: token
      filter:
        expression: "body.payload.ref_type == 'tag'"
      pollInterval: 30s

    mirrorservice:
      owner: wlanboy
      repository: MirrorService
      events:
        - create
      apiToken:
        name: github-token
        key: token
      filter:
        expression: "body.payload.ref_type == 'tag'"
      pollInterval: 30s

    javahttpclient:
      owner: wlanboy
      repository: JavaHttpClient
      events:
        - create
      apiToken:
        name: github-token
        key: token
      filter:
        expression: "body.payload.ref_type == 'tag'"
      pollInterval: 30s

    simpleservice:
      owner: wlanboy
      repository: SimpleService
      events:
        - create
      apiToken:
        name: github-token
        key: token
      filter:
        expression: "body.payload.ref_type == 'tag'"
      pollInterval: 30s
